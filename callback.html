<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>OAuth Callback</title>
</head>
<body>
<script>
(async () => {
  const params = new URLSearchParams(window.location.search);

  // Spotify sends ?code=... here
  if(params.get("code")){
    localStorage.setItem("spotify_auth_code", params.get("code"));
  }

  // Google sends #access_token=... in hash
  if(window.location.hash.startsWith("#")){
    const hashParams = new URLSearchParams(window.location.hash.substring(1));
    if(hashParams.get("access_token")){
      localStorage.setItem("oauth_data", JSON.stringify({
        access_token: hashParams.get("access_token"),
        expires_in: hashParams.get("expires_in"),
        scope: hashParams.get("scope")
      }));
    }
  }

  // Close popup if opened, otherwise redirect home
  if(window.opener){
    window.close();
  } else {
    window.location = "./index.html";
  }
})();
</script>
</body>
</html>
