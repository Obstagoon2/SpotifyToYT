<!DOCTYPE html>
<html>
<body>
<script>
(async () => {
  const params = new URLSearchParams(window.location.search);

  // For Spotify PKCE flow
  if(params.get("code")){
    localStorage.setItem("spotify_auth_code", params.get("code"));
  }

  // For Google implicit flow
  if(window.location.hash.startsWith("#")){
    const hashParams = new URLSearchParams(window.location.hash.substring(1));
    if(hashParams.get("access_token")){
      localStorage.setItem("oauth_data", JSON.stringify({
        access_token: hashParams.get("access_token"),
        expires_in: hashParams.get("expires_in"),
        scope: hashParams.get("scope")
      }));
    }
  }

  // Close popup or redirect back
  if(window.opener){
    window.close();
  } else {
    window.location = "/";
  }
})();
</script>
</body>
</html>
